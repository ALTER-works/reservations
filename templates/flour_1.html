<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>План этажа гостиницы с календарём</title>
<style>
  /* --- Стиль --- */
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    background: #fefefe;
    display: flex;
    height: 100vh;
  }

  /* --- ввод этажа --- */
  #main-content {
    height: 100vh;
    padding: 40px 80px;
    box-sizing: border-box;
    background: white;
    display: flex;
    gap: 50px;
    align-items: center;
    justify-content: center;
  }
          /* Левая часть — форма */
        #form-container {
            flex: 1;
            max-width: 400px;
        }
        #form-container h2 {
            margin-bottom: 20px;
            color: #222;
        }
        #floor-select {
            width: 100%;
            padding: 12px 15px;
            font-size: 1em;
            border-radius: 15px;
            border: 1px solid #ccc;
            margin-bottom: 30px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        #floor-select:focus {
            border-color: #007bff;
        }
        #submit-btn {
            padding: 15px 40px;
            font-size: 1.1em;
            border: none;
            border-radius: 25px;
            background-color: #28a745;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(40,167,69,0.4);
            transition: background-color 0.3s ease;
        }
        #submit-btn:hover {
            background-color: #1e7e34;
        }

  /* --- Пример вывода этажа --- */
  #floor-plan {
    flex: 1;
    padding: 20px;
    box-sizing: border-box;
    border-right: 2px solid #ddd;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #fff;
  }
  svg {
    width: 90%;
    height: 90%;
    border: 1px solid #aaa;
    border-radius: 8px;
    background: #fafafa;
  }
  .room {
    stroke: #444;
    stroke-width: 2;
    cursor: pointer;
    fill: #eee; /* нейтральный цвет без заливки */
    transition: fill 0.3s ease;
  }
  .room:hover {
    fill: #ccc;
  }

  #info-panel {
    width: 320px;
    padding: 30px 25px;
    box-sizing: border-box;
    background: #fff;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    color: #333;
  }
  #info-panel h2 {
    margin-top: 0;
    font-weight: 700;
    font-size: 1.5em;
    margin-bottom: 25px;
  }
  #legend {
    font-size: 0.9em;
    color: #555;
    margin-top: auto;
  }
  #legend div {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
  }
  .color-box {
    width: 18px;
    height: 18px;
    margin-right: 12px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  /* Оверлей */
  #overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }
  #overlay-content {
    background: white;
    width: 450px;
    max-width: 95vw;
    border-radius: 10px;
    padding: 25px 30px;
    box-sizing: border-box;
    position: relative;
  }
  #overlay-content h3 {
    margin-top: 0;
    font-weight: 700;
    font-size: 1.3em;
  }
  #overlay-close {
    position: absolute;
    top: 12px;
    right: 15px;
    background: #f25c54;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 6px 18px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }
  #overlay-close:hover {
    background: #c8423f;
  }

  /* Календарь */
  #calendar {
    margin-top: 15px;
  }
  #calendar table {
    width: 100%;
    border-collapse: collapse;
    user-select: none;
  }
  #calendar th, #calendar td {
    width: 14.28%;
    text-align: center;
    padding: 8px 0;
    border: 1px solid #ddd;
    cursor: pointer;
  }
  #calendar th {
    background: #f0f0f0;
    font-weight: 600;
  }
  #calendar td:hover:not(.empty) {
    background: #e0e0e0;
  }
  #calendar td.empty {
    background: #fafafa;
    cursor: default;
  }
  #calendar td.selected {
    background: #007bff;
    color: white;
    font-weight: bold;
  }

  /* Расписание */
  #schedule {
    margin-top: 15px;
    border: 1px solid #ddd;
    padding: 10px;
    max-height: 200px;
    overflow-y: auto;
    display: none;
  }
  #schedule ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  #schedule li {
    padding: 4px 0;
    border-bottom: 1px solid #eee;
    font-family: monospace;
  }
  #schedule li:last-child {
    border-bottom: none;
  }

  /* Кнопка Back */
  #back-btn {
    margin-top: 25px;
    padding: 12px 35px;
    font-size: 1em;
    border-radius: 25px;
    border: none;
    background-color: #4caf50;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(76,175,80,0.4);
    transition: background-color 0.3s ease;
  }
  #back-btn:hover {
    background-color: #388e3c;
  }
</style>
</head>
<body>

<div id="floor-plan" aria-label="План этажа гостиницы">
  <svg viewBox="0 0 600 400" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svg-title">
    <title id="svg-title">План этажа с комнатами</title>
    <rect id="room1" class="room" x="30" y="30" width="180" height="140" rx="10" ry="10" />
    <rect id="room2" class="room" x="230" y="30" width="180" height="140" rx="10" ry="10" />
    <rect id="room3" class="room" x="430" y="30" width="140" height="140" rx="10" ry="10" />
    <rect id="room4" class="room" x="30" y="200" width="180" height="140" rx="10" ry="10" />
    <rect id="room5" class="room" x="230" y="200" width="340" height="140" rx="10" ry="10" />
  </svg>
</div>

<div id="info-panel" role="region" aria-live="polite">
  <h2>Выберите комнату на плане</h2>
  <button id="back-btn" style="display:none;">Back</button>
</div>

<div id="overlay" role="dialog" aria-modal="true" aria-labelledby="overlay-title">
  <div id="overlay-content">
    <button id="overlay-close" aria-label="Закрыть">Back</button>
    <h3 id="overlay-title"></h3>
    <div id="calendar" aria-label="Календарь выбора дня"></div>
    <div id="schedule" aria-label="Расписание занятости комнаты">
      <strong>Расписание занятости:</strong>
      <ul id="schedule-list"></ul>
    </div>
  </div>
</div>

<div id="main-content" aria-hidden="true">
    <div id="form-container">
        <h2>Выберите этаж для бронирования</h2>
        <form id="floor-form" method="post" action="/">
            <select id="floor-select" name="floor" required>
                <option value="1">Этаж 1</option>
                <option value="2" disabled>Этаж 2 (временно недоступен)</option>
                <option value="3" disabled>Этаж 3 (временно недоступен)</option>
            </select>
            <br />
            <button type="submit" id="submit-btn">Submit</button>
        </form>
    </div>
</div>

<script>
  // Пример расписания бронирования по часам для комнат и дней
  // Формат: для каждого дня список занятых слотов (в формате "HH:MM-HH:MM")
  const bookingSchedule = {
    room1: {
      "2025-07-14": ["09:00-10:00", "14:00-15:00"],
      "2025-07-15": ["10:00-11:00"]
    },
    room2: {
      "2025-07-14": ["08:00-09:00", "11:00-12:00", "15:00-16:00"],
      "2025-07-16": ["09:00-10:00"]
    },
    room3: {
      "2025-07-14": ["00:00-23:59"], // полностью занята
      "2025-07-15": ["00:00-23:59"]
    },
    room4: {
      "2025-07-14": [],
      "2025-07-15": ["13:00-14:00"]
    },
    room5: {
      "2025-07-14": ["09:30-10:30"],
      "2025-07-17": ["10:00-11:00"]
    }
  };

  const overlay = document.getElementById('overlay');
  const overlayTitle = document.getElementById('overlay-title');
  const calendarDiv = document.getElementById('calendar');
  const scheduleDiv = document.getElementById('schedule');
  const scheduleList = document.getElementById('schedule-list');
  const overlayCloseBtn = document.getElementById('overlay-close');
  const backBtn = document.getElementById('back-btn');

  // Создаём календарь месяца для выбранной комнаты
  function createCalendar(year, month, roomId) {
    calendarDiv.innerHTML = ''; // очистить
    scheduleDiv.style.display = 'none';
    scheduleList.innerHTML = '';

    const date = new Date(year, month, 1);
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const firstDayWeekday = date.getDay(); // 0 - воскресенье, 1 - понедельник ...

    // Заголовки дней недели (Пн-Вс)
    const daysOfWeek = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];

    // Создаём таблицу календаря
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const trHead = document.createElement('tr');
    daysOfWeek.forEach(day => {
      const th = document.createElement('th');
      th.textContent = day;
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);
    table.appendChild(thead);

    const tbody = document.createElement('tbody');
    let tr = document.createElement('tr');

    // Смещение для первого дня (сдвигаем по Пн=0)
    let offset = firstDayWeekday === 0 ? 6 : firstDayWeekday - 1;
    for (let i = 0; i < offset; i++) {
      const td = document.createElement('td');
      td.classList.add('empty');
      tr.appendChild(td);
    }

    for (let day = 1; day <= daysInMonth; day++) {
      if ((offset + day -1) % 7 === 0 && day !== 1) {
        tbody.appendChild(tr);
        tr = document.createElement('tr');
      }
      const td = document.createElement('td');
      td.textContent = day;
      td.classList.add('calendar-day');
      td.style.userSelect = 'none';

      // При клике показываем расписание на этот день
      td.addEventListener('click', () => {
        // Снимаем выделение с других дней
        tbody.querySelectorAll('td.selected').forEach(el => el.classList.remove('selected'));
        td.classList.add('selected');

        const dayStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        showSchedule(roomId, dayStr);
      });

      tr.appendChild(td);
    }

    // Заполняем последнюю строку пустыми ячейками, если нужно
    while (tr.children.length < 7) {
      const td = document.createElement('td');
      td.classList.add('empty');
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
    table.appendChild(tbody);
    calendarDiv.appendChild(table);
  }

  // Показать расписание для комнаты и дня
  function showSchedule(roomId, dayStr) {
    scheduleList.innerHTML = '';
    scheduleDiv.style.display = 'block';
    const slots = bookingSchedule[roomId]?.[dayStr] || [];

    // Формируем полный список слотов по часам (например, каждый час с 00:00)
    // Для упрощения - слоты по 1 часу с 00:00 до 23:00
    const allSlots = [];
    for(let h=0; h<24; h++) {
      const start = `${String(h).padStart(2,'0')}:00`;
      const end = `${String(h+1).padStart(2,'0')}:00`;
      allSlots.push(`${start}-${end}`);
    }

    // Для каждого слота показываем, занят он или свободен
    allSlots.forEach(slot => {
      const li = document.createElement('li');
      li.textContent = slot;
      if (slots.includes(slot) || slots.includes("00:00-23:59")) {
        li.style.color = 'red';
        li.textContent += ' — занято';
      } else {
        li.style.color = 'green';
        li.textContent += ' — свободно';
      }
      scheduleList.appendChild(li);
    });
  }

  // Клик по комнате — открыть оверлей с календарём
  document.querySelectorAll('.room').forEach(room => {
    room.addEventListener('click', () => {
      const roomId = room.id;
      overlayTitle.textContent = `Комната ${roomId.toUpperCase()}`;

      // Текущая дата для календаря
      const now = new Date();
      createCalendar(now.getFullYear(), now.getMonth(), roomId);

      overlay.style.display = 'flex';
    });
  });

  // Закрыть оверлей
  overlayCloseBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
    scheduleDiv.style.display = 'none';
  });

  // Кнопка Back справа (можно добавить логику)
  backBtn.addEventListener('click', () => {
    alert('Back button clicked');
  });
</script>

</body>
</html>
